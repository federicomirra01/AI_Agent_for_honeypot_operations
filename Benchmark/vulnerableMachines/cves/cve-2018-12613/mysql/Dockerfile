FROM mysql:5.5

# Set environment variables
ENV MYSQL_RANDOM_ROOT_PASSWORD=yes
ENV MYSQL_DATABASE=admin
ENV MYSQL_USER=admin
ENV MYSQL_PASSWORD=123456

# Install iptables and procps (for ps command)
RUN echo "deb http://archive.debian.org/debian/ stretch main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security stretch/updates main" >> /etc/apt/sources.list && \
    apt-get -o Acquire::Check-Valid-Until=false update && \
    apt-get --no-install-recommends --allow-unauthenticated install -y iptables procps && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Copy the custom entrypoint script
COPY custom_entrypoint.sh /custom_entrypoint.sh
RUN chmod +x /custom_entrypoint.sh

# Expose MySQL port
# EXPOSE 3306

# Use custom entrypoint
ENTRYPOINT ["/custom_entrypoint.sh"]
